
<svg xmlns="http://www.w3.org/2000/svg" width="400" height="600" viewBox="0 0 400 600">
  <style>
    svg {
      touch-action: none;
    }
    svg:not(.-dragging) .course polyline {
      transition: stroke-dashoffset .3s;
    }
  </style>
  <g fill="#fff" stroke="#000" stroke-linecap="round">
    <polyline points="80 60 80 540"/>
    <polyline points="140 60 140 540"/>
    <polyline points="200 60 200 540"/>
    <polyline points="260 60 260 540"/>
    <polyline points="320 60 320 540"/>
    <polyline points="140 100 200 100"/>
    <polyline points="140 170 200 170"/>
    <polyline points="80 140 140 140"/>
    <polyline points="80 380 140 380"/>
    <polyline points="80 320 140 320"/>
    <polyline points="80 250 140 250"/>
    <polyline points="140 220 200 220"/>
    <polyline points="200 190 260 190"/>
    <polyline points="140 510 200 510"/>
    <polyline points="140 420 200 420"/>
    <polyline points="80 460 140 460"/>
    <polyline points="200 260 260 260"/>
    <polyline points="200 340 260 340"/>
    <polyline points="200 480 260 480"/>
    <polyline points="260 140 320 140"/>
    <polyline points="260 240 320 240"/>
    <polyline points="260 370 320 370"/>
    <polyline points="260 430 320 430"/>
    <polyline points="260 300 320 300"/>
    <polyline points="140 300 200 300"/>
  </g>
  <g fill="#b7b7b7" stroke="#b7b7b7" stroke-width="1.5">
    <line x1="79.99" y1="40" x2="80.01" y2="48.38"/>
    <path d="m80.01,52c-.64-1.7-1.72-3.81-2.87-5.12l2.86,1.03,2.85-1.04c-1.14,1.31-2.21,3.43-2.84,5.14Z" />
    <line x1="139.99" y1="40" x2="140.01" y2="48.38"/>
    <path d="m140.01,52c-.64-1.7-1.72-3.81-2.87-5.12l2.86,1.03,2.85-1.04c-1.14,1.31-2.21,3.43-2.84,5.14Z"/>
    <line x1="199.99" y1="40" x2="200.01" y2="48.38"/>
    <path d="m200.01,52c-.64-1.7-1.72-3.81-2.87-5.12l2.86,1.03,2.85-1.04c-1.14,1.31-2.21,3.43-2.84,5.14Z"/>
    <line x1="259.99" y1="40" x2="260.01" y2="48.38"/>
    <path d="m260.01,52c-.64-1.7-1.72-3.81-2.87-5.12l2.86,1.03,2.85-1.04c-1.14,1.31-2.21,3.43-2.84,5.14Z"/>
    <line x1="319.99" y1="40" x2="320.01" y2="48.38"/>
    <path d="m320.01,52c-.64-1.7-1.72-3.81-2.87-5.12l2.86,1.03,2.85-1.04c-1.14,1.31-2.21,3.43-2.84,5.14Z"/>
  </g>
  <path d="m92.19,28.19c0,6.74-5.45,12.19-12.19,12.19s-12.19-5.45-12.19-12.19,5.5-12.19,12.19-12.19,12.19,5.37,12.19,12.19Zm-23.47,0c0,6.22,5.06,11.29,11.29,11.29s11.29-5.07,11.29-11.29-5.12-11.29-11.29-11.29-11.29,4.99-11.29,11.29Zm10.54-7.12h2.75v14.24h-3.08v-10.98l-2.52,1.75-.36-2.83,3.21-2.19Zm72.93,7.12c0,6.74-5.45,12.19-12.19,12.19s-12.19-5.45-12.19-12.19,5.5-12.19,12.19-12.19,12.19,5.37,12.19,12.19Zm-23.47,0c0,6.22,5.06,11.29,11.29,11.29s11.29-5.07,11.29-11.29-5.12-11.29-11.29-11.29-11.29,4.99-11.29,11.29Zm16.53,4.17v2.8h-11.06c1.75-1.88,4.09-4.45,5.73-6.56,1.41-1.85,1.7-2.6,1.7-3.37s-.46-1.8-1.75-1.8c-1.98,0-3.03,1.7-3.45,2.39l-1.36-2.83c1.23-1.57,2.83-2.37,4.83-2.37,2.65,0,4.78,1.62,4.78,4.52,0,2.47-1.49,4.17-4.17,7.2h4.73Zm66.94-4.17c0,6.74-5.45,12.19-12.19,12.19s-12.19-5.45-12.19-12.19,5.5-12.19,12.19-12.19,12.19,5.37,12.19,12.19Zm-23.47,0c0,6.22,5.06,11.29,11.29,11.29s11.29-5.07,11.29-11.29-5.12-11.29-11.29-11.29-11.29,4.99-11.29,11.29Zm7.02,3.52c1.67,1.08,3.32,1.08,3.78,1.08,1.59,0,2.88-.62,2.88-1.98,0-.59-.28-1.72-2.65-1.72h-1.59v-2.52h1.36c1.26,0,2.11-.57,2.11-1.57,0-1.11-1.13-1.41-1.85-1.41-.44,0-1.85,0-3.37,1.59l-1.05-2.6c1.93-1.8,3.99-1.8,4.63-1.8,3.03,0,4.71,1.88,4.71,3.98,0,.31,0,1.83-1.54,2.78,1.52.72,2.31,1.9,2.31,3.57,0,2.24-1.65,4.47-5.91,4.47-2.06,0-3.42-.49-4.68-1.18l.87-2.7Zm76.46-3.52c0,6.74-5.45,12.19-12.19,12.19s-12.19-5.45-12.19-12.19,5.5-12.19,12.19-12.19,12.19,5.37,12.19,12.19Zm-23.47,0c0,6.22,5.06,11.29,11.29,11.29s11.29-5.07,11.29-11.29-5.12-11.29-11.29-11.29-11.29,4.99-11.29,11.29Zm11.34,6.89v-2.75h-6.09v-2.49l6.2-9h2.88v8.79h1.7v2.7h-1.7v2.75h-2.98Zm-3.06-5.45h3.06v-4.5l-3.06,4.5Zm75.2-1.44c0,6.74-5.45,12.19-12.19,12.19s-12.19-5.45-12.19-12.19,5.5-12.19,12.19-12.19,12.19,5.37,12.19,12.19Zm-23.47,0c0,6.22,5.06,11.29,11.29,11.29s11.29-5.07,11.29-11.29-5.12-11.29-11.29-11.29-11.29,4.99-11.29,11.29Zm15.53-4.32h-5.58v2.26c.36-.1.87-.26,1.72-.26,2.21,0,4.89,1.44,4.89,4.73,0,2.37-1.52,4.99-5.79,4.99-2.34,0-3.73-.67-4.55-1.05l.69-2.8c1.85,1.05,3.34,1.05,3.81,1.05,2.01,0,2.78-1.03,2.78-2.13s-.82-1.98-2.16-1.98c-.72,0-1.39.26-1.83.82h-2.49v-8.43h8.51v2.8Z"/>
  <polygon points="140 582.39 134.73 573.08 124.16 574.76 128.15 564.84 120.25 557.62 130.5 554.55 131.21 543.88 140 549.98 148.79 543.88 149.5 554.55 159.75 557.62 151.85 564.84 155.84 574.76 145.27 573.08 140 582.39" fill="#ff0" stroke="red" stroke-width="3"/>
  <path d="m127.15,557.87c.18-1,.32-1.38,1.08-1.38.49,0,1.02.19,1.02.78,0,.19-.05.41-.07.54.64-.05,1.31-.11,2.1-.22.79-.11,1.13-.16,1.32-.16.6,0,.9.42.9.97,0,.7-.38.88-1.01.97-.68.11-2.46.28-3.71.35-.02.19-.02.22-.06.44.4-.05.65-.08,1.15-.08.96,0,2.33.16,3.29.95.71.58,1.19,1.46,1.19,2.65,0,2.51-2.45,3.45-3.55,3.45-.64,0-.9-.49-.9-1.02s.2-.7.61-.82c.78-.22,1.77-.48,1.77-1.67,0-.38-.07-1.01-.73-1.4-1.93,3.84-4.25,4.7-5.48,4.7s-2.25-.83-2.25-2.43c0-1.78,1.36-3.17,2.99-3.84.05-.52.05-.58.07-.85-.1,0-.79,0-1.45-.01-.34-.01-1.07-.02-1.07-1.02,0-.76.48-.96,1.03-.96.22,0,1.43.05,1.7.05h.06Zm-1.42,6.51c0,.1,0,.59.52.59.3,0,.53-.11.74-.22-.17-.89-.2-1.76-.22-2.05-.73.52-1.04,1.16-1.04,1.68Zm2.96-1c.46-.54.88-1.24,1.04-1.55-.22-.01-.59-.01-1.13.11,0,.3.01.78.08,1.44Zm9.64,1.63c-.55,1.54-.76,1.91-1.4,1.91-.52,0-1.24-.31-1.24-.94,0-.23.05-.32.43-1.19.23-.5.91-2.16,1.57-4.64-1.28.06-2.03.1-2.03-.96,0-.86.53-1.03,1.09-1.03h1.39c.04-.17.19-.98.28-1.26.06-.22.25-.55.92-.55.48,0,1.1.23,1.1.79,0,.23-.13.8-.14.84.38-.06,1.33-.22,1.51-.22.68,0,.91.52.91,1,0,.79-.38.91-2.89,1.21-.62,2.53-1.25,4.29-1.51,5.04Zm2.24-1.91c.55,0,.95.25.95.61,0,.12-.07.25-.16.38-.11.17-.14.29-.14.4,0,.5.73.56,1.86.56.4,0,.94-.02,1.3-.06.11-.01.62-.06.76-.06.64,0,.88.44.88.91,0,1.05-.55,1.19-2.85,1.19-1.34,0-3.91,0-3.91-2.12,0-.52.38-1.81,1.33-1.81Zm2.97-3.17c1.5,0,2.22.04,2.22,1.02,0,.43-.18.98-.86.98-.16,0-1.4-.1-1.68-.1-.6,0-1.01.04-1.18.05-.13.01-.68.06-.8.06-.6,0-.78-.42-.78-.96,0-.76.34-1.06,3.08-1.06Zm6.97.13c.29,0,.76.25.76.68,0,.14-.04.25-.4.92-.54,1-.72,1.58-.91,2.21-.16.5-.34.85-1.04.85-.6,0-.85-.24-1.02-.75-.13-.42-.32-1.63-.32-3.13s.14-2.75.24-3.23c.06-.32.18-.85,1-.85.34,0,1.15.11,1.15.82,0,.25-.18,1.34-.2,1.57-.11.8-.12,1.25-.13,1.92.35-.72.5-1.01.89-1.01Zm5.06-2.34c.06.54.13,1.87.13,3.12,0,3.08-.76,4.56-2.52,5.84-.8.59-1.15.65-1.44.65-.74,0-1.13-.66-1.13-1.14s.28-.64.8-.97c1.73-1.1,2.09-2.41,2.09-4.52,0-.6-.02-1.55-.07-2.09-.01-.08-.06-.78-.06-.92,0-.79.49-1.02,1.02-1.02.97,0,1.12.53,1.18,1.06Zm-91.89-.37c.1-.28.34-.59.95-.59.29,0,1.06.12,1.06.85,0,.14-.01.3-.06.56-.22,1.29-.43,2.54-.43,4.27,0,1.13.11,2.23.25,3.09.08.47.11.62.11.78,0,.44-.36.8-1.08.8-.61,0-.8-.23-.89-.41-.4-.84-.43-3.32-.43-4.41,0-1.49.24-4.2.53-4.95Zm7.7,5.67c1.81.76,2.05,1.16,2.05,1.7s-.35,1.08-.88,1.08c-.2,0-.3-.06-1.19-.6-.07.56-.24,1.91-2.45,1.91-1.43,0-2.88-.68-2.88-2.29,0-1.27.91-2.33,2.67-2.33.22,0,.35.01.59.04l-.04-1.69c-.86.02-2.4.04-2.71-.1-.37-.16-.55-.47-.55-.95,0-.56.24-1.02.96-1.02.62,0,1.63.05,2.25.04l-.02-1.13c-.01-.77.4-1.08,1.03-1.08,1.01,0,1.02.71,1.03,1.07l.02,1c.35-.04.91-.11,1.03-.11.7,0,.89.5.89,1.02,0,.98-.59,1.03-1.87,1.14l.05,2.3Zm-2.67,1.26c-.28,0-.82.07-.82.52,0,.36.34.54.78.54.71,0,.7-.44.68-.96-.12-.04-.32-.1-.65-.1Zm13.31-1.21c.01,1.05-.1,2.49-1.62,3.57-.56.41-1.52.91-2.03.91-.66,0-1.01-.62-1.01-1.1,0-.53.24-.61,1.06-.92.66-.25,1.01-.54,1.16-.66-.17.08-.38.2-.86.2-1.16,0-2.3-.9-2.3-2.39,0-1.21.79-2.42,2.55-2.42.43,0,.67.07.96.18v-.6s-2.89.01-2.89.01c-.23,0-1.26.04-1.46.04-.77,0-1.24-.18-1.24-.95,0-.9.72-.9,1.19-.9.23,0,1.27.01,1.48.01h2.88s-.01-.66-.01-.66c0-.25-.01-1.02,1.04-1.02s1.04.75,1.04,1.01v.65c.6,0,.61,0,1.21-.01-.13-.06-.17-.11-.44-.58-.14-.23-.3-.43-.48-.68-.08-.11-.13-.23-.13-.31,0-.28.25-.52.56-.52.22,0,.35.11.82.79.37.55.4.71.4.83,0,.16-.07.36-.31.47.52,0,1.21,0,1.21.91s-.73.91-1.12.91c-.26,0-1.44-.01-1.69-.01l.04,3.24Zm-2.88-1.3c-.42,0-.77.35-.77.88s.38.85.78.85.72-.28.72-.88-.41-.85-.73-.85Zm6.74-3.93c0,.31-.26.52-.54.52s-.36-.16-.53-.48c-.29-.54-.5-.83-.73-1.13-.07-.08-.16-.23-.16-.35,0-.36.4-.59.66-.5.35.1,1.3,1.63,1.3,1.94Zm2.68,2.73c-.28.04-.88.12-1.12.12-.68,0-.91-.6-.91-1.08,0-.4.16-.9.84-.96.19-.02,1.03-.07,1.21-.1v-.8c0-.47.01-1.24,1-1.24s1.01.72,1.01,1.08c0,.29-.02,1.55-.04,1.8.64-.59,1.54-1.43,2.9-1.43.17,0,2.46,0,2.46,2.38,0,.6-.4,3.21-.4,3.74,0,.13.01.37.24.37.16,0,.28-.08.6-.28.11-.06.23-.12.37-.12.42,0,.73.46.73.98,0,1.16-1.61,1.57-2.27,1.57-1.5,0-1.85-1.12-1.85-1.97,0-.65.43-3.74.43-4.03,0-.19,0-.67-.59-.67-.5,0-1.21.28-2.66,1.93,0,.67.01,3.65,0,4.25,0,.53-.01,1.19-1.02,1.19-.67,0-1-.38-1-1.02v-1.7c-.56.85-.73,1.09-1.18,1.09-.56,0-1.03-.5-1.03-1.03,0-.28.11-.48.44-.92.28-.38,1.56-2.01,1.81-2.35v-.8Zm95.12-3.23c.1-.28.34-.59.95-.59.29,0,1.06.12,1.06.85,0,.14-.01.3-.06.56-.22,1.29-.43,2.54-.43,4.27,0,1.13.11,2.23.25,3.09.08.47.11.62.11.78,0,.44-.36.8-1.08.8-.61,0-.8-.23-.89-.41-.4-.84-.43-3.32-.43-4.41,0-1.49.24-4.2.53-4.95Zm7.7,5.67c1.81.76,2.05,1.16,2.05,1.7s-.35,1.08-.88,1.08c-.2,0-.3-.06-1.19-.6-.07.56-.24,1.91-2.45,1.91-1.43,0-2.88-.68-2.88-2.29,0-1.27.91-2.33,2.67-2.33.22,0,.35.01.59.04l-.04-1.69c-.86.02-2.4.04-2.71-.1-.37-.16-.55-.47-.55-.95,0-.56.24-1.02.96-1.02.62,0,1.63.05,2.25.04l-.02-1.13c-.01-.77.4-1.08,1.03-1.08,1.01,0,1.02.71,1.03,1.07l.02,1c.35-.04.91-.11,1.03-.11.7,0,.89.5.89,1.02,0,.98-.59,1.03-1.87,1.14l.05,2.3Zm-2.67,1.26c-.28,0-.82.07-.82.52,0,.36.34.54.78.54.71,0,.7-.44.68-.96-.12-.04-.32-.1-.65-.1Zm13.31-1.21c.01,1.05-.1,2.49-1.62,3.57-.56.41-1.52.91-2.03.91-.66,0-1.01-.62-1.01-1.1,0-.53.24-.61,1.06-.92.66-.25,1.01-.54,1.16-.66-.17.08-.38.2-.86.2-1.16,0-2.3-.9-2.3-2.39,0-1.21.79-2.42,2.55-2.42.43,0,.67.07.96.18v-.6s-2.89.01-2.89.01c-.23,0-1.26.04-1.46.04-.77,0-1.24-.18-1.24-.95,0-.9.72-.9,1.19-.9.23,0,1.27.01,1.48.01h2.88s-.01-.66-.01-.66c0-.25-.01-1.02,1.04-1.02s1.04.75,1.04,1.01v.65c.6,0,.61,0,1.21-.01-.13-.06-.17-.11-.44-.58-.14-.23-.3-.43-.48-.68-.08-.11-.13-.23-.13-.31,0-.28.25-.52.56-.52.22,0,.35.11.82.79.37.55.4.71.4.83,0,.16-.07.36-.31.47.52,0,1.21,0,1.21.91s-.73.91-1.12.91c-.26,0-1.44-.01-1.69-.01l.04,3.24Zm-2.88-1.3c-.42,0-.77.35-.77.88s.38.85.78.85.72-.28.72-.88-.41-.85-.73-.85Zm6.74-3.93c0,.31-.26.52-.54.52s-.36-.16-.53-.48c-.29-.54-.5-.83-.73-1.13-.07-.08-.16-.23-.16-.35,0-.36.4-.59.66-.5.35.1,1.3,1.63,1.3,1.94Zm2.68,2.73c-.28.04-.88.12-1.12.12-.68,0-.91-.6-.91-1.08,0-.4.16-.9.84-.96.19-.02,1.03-.07,1.21-.1v-.8c0-.47.01-1.24,1-1.24s1.01.72,1.01,1.08c0,.29-.02,1.55-.04,1.8.64-.59,1.54-1.43,2.9-1.43.17,0,2.46,0,2.46,2.38,0,.6-.4,3.21-.4,3.74,0,.13.01.37.24.37.16,0,.28-.08.6-.28.11-.06.23-.12.37-.12.42,0,.73.46.73.98,0,1.16-1.61,1.57-2.27,1.57-1.5,0-1.85-1.12-1.85-1.97,0-.65.43-3.74.43-4.03,0-.19,0-.67-.59-.67-.5,0-1.21.28-2.66,1.93,0,.67.01,3.65,0,4.25,0,.53-.01,1.19-1.02,1.19-.67,0-1-.38-1-1.02v-1.7c-.56.85-.73,1.09-1.17,1.09-.56,0-1.03-.5-1.03-1.03,0-.28.11-.48.44-.92.28-.38,1.56-2.01,1.81-2.35v-.8Zm35.12-3.23c.1-.28.34-.59.95-.59.29,0,1.06.12,1.06.85,0,.14-.01.3-.06.56-.22,1.29-.43,2.54-.43,4.27,0,1.13.11,2.23.25,3.09.08.47.11.62.11.78,0,.44-.36.8-1.08.8-.61,0-.8-.23-.89-.41-.4-.84-.43-3.32-.43-4.41,0-1.49.24-4.2.53-4.95Zm7.7,5.67c1.81.76,2.05,1.16,2.05,1.7s-.35,1.08-.88,1.08c-.2,0-.3-.06-1.19-.6-.07.56-.24,1.91-2.45,1.91-1.43,0-2.88-.68-2.88-2.29,0-1.27.91-2.33,2.67-2.33.22,0,.35.01.59.04l-.04-1.69c-.86.02-2.4.04-2.71-.1-.37-.16-.55-.47-.55-.95,0-.56.24-1.02.96-1.02.62,0,1.63.05,2.25.04l-.02-1.13c-.01-.77.4-1.08,1.03-1.08,1.01,0,1.02.71,1.03,1.07l.02,1c.35-.04.91-.11,1.03-.11.7,0,.89.5.89,1.02,0,.98-.59,1.03-1.87,1.14l.05,2.3Zm-2.67,1.26c-.28,0-.82.07-.82.52,0,.36.34.54.78.54.71,0,.7-.44.68-.96-.12-.04-.32-.1-.65-.1Zm13.31-1.21c.01,1.05-.1,2.49-1.62,3.57-.56.41-1.52.91-2.03.91-.66,0-1.01-.62-1.01-1.1,0-.53.24-.61,1.06-.92.66-.25,1.01-.54,1.16-.66-.17.08-.38.2-.86.2-1.16,0-2.3-.9-2.3-2.39,0-1.21.79-2.42,2.55-2.42.43,0,.67.07.96.18v-.6s-2.89.01-2.89.01c-.23,0-1.26.04-1.46.04-.77,0-1.24-.18-1.24-.95,0-.9.72-.9,1.19-.9.23,0,1.27.01,1.48.01h2.88s-.01-.66-.01-.66c0-.25-.01-1.02,1.04-1.02s1.04.75,1.04,1.01v.65c.6,0,.61,0,1.21-.01-.13-.06-.17-.11-.44-.58-.14-.23-.3-.43-.48-.68-.08-.11-.13-.23-.13-.31,0-.28.25-.52.56-.52.22,0,.35.11.82.79.37.55.4.71.4.83,0,.16-.07.36-.31.47.52,0,1.21,0,1.21.91s-.73.91-1.12.91c-.26,0-1.44-.01-1.69-.01l.04,3.24Zm-2.88-1.3c-.42,0-.77.35-.77.88s.38.85.78.85.72-.28.72-.88-.41-.85-.73-.85Zm6.74-3.93c0,.31-.26.52-.54.52s-.36-.16-.53-.48c-.29-.54-.5-.83-.73-1.13-.07-.08-.16-.23-.16-.35,0-.36.4-.59.66-.5.35.1,1.29,1.63,1.29,1.94Zm2.68,2.73c-.28.04-.88.12-1.12.12-.68,0-.91-.6-.91-1.08,0-.4.16-.9.84-.96.19-.02,1.03-.07,1.21-.1v-.8c0-.47.01-1.24,1-1.24s1.01.72,1.01,1.08c0,.29-.02,1.55-.04,1.8.64-.59,1.54-1.43,2.9-1.43.17,0,2.46,0,2.46,2.38,0,.6-.4,3.21-.4,3.74,0,.13.01.37.24.37.16,0,.28-.08.6-.28.11-.06.23-.12.37-.12.42,0,.73.46.73.98,0,1.16-1.61,1.57-2.27,1.57-1.5,0-1.85-1.12-1.85-1.97,0-.65.43-3.74.43-4.03,0-.19,0-.67-.59-.67-.5,0-1.21.28-2.66,1.93,0,.67.01,3.65,0,4.25,0,.53-.01,1.19-1.02,1.19-.67,0-1-.38-1-1.02v-1.7c-.56.85-.73,1.09-1.18,1.09-.56,0-1.03-.5-1.03-1.03,0-.28.11-.48.44-.92.28-.38,1.56-2.01,1.81-2.35v-.8Zm35.12-3.23c.1-.28.34-.59.95-.59.29,0,1.06.12,1.06.85,0,.14-.01.3-.06.56-.22,1.29-.43,2.54-.43,4.27,0,1.13.11,2.23.25,3.09.08.47.11.62.11.78,0,.44-.36.8-1.08.8-.61,0-.8-.23-.89-.41-.4-.84-.43-3.32-.43-4.41,0-1.49.24-4.2.53-4.95Zm7.7,5.67c1.81.76,2.05,1.16,2.05,1.7s-.35,1.08-.88,1.08c-.2,0-.3-.06-1.19-.6-.07.56-.24,1.91-2.45,1.91-1.43,0-2.88-.68-2.88-2.29,0-1.27.91-2.33,2.67-2.33.22,0,.35.01.59.04l-.04-1.69c-.86.02-2.4.04-2.71-.1-.37-.16-.55-.47-.55-.95,0-.56.24-1.02.96-1.02.62,0,1.63.05,2.25.04l-.02-1.13c-.01-.77.4-1.08,1.03-1.08,1.01,0,1.02.71,1.03,1.07l.02,1c.35-.04.91-.11,1.03-.11.7,0,.89.5.89,1.02,0,.98-.59,1.03-1.87,1.14l.05,2.3Zm-2.67,1.26c-.28,0-.82.07-.82.52,0,.36.34.54.78.54.71,0,.7-.44.68-.96-.12-.04-.32-.1-.65-.1Zm13.31-1.21c.01,1.05-.1,2.49-1.62,3.57-.56.41-1.52.91-2.03.91-.66,0-1.01-.62-1.01-1.1,0-.53.24-.61,1.06-.92.66-.25,1.01-.54,1.16-.66-.17.08-.38.2-.86.2-1.16,0-2.3-.9-2.3-2.39,0-1.21.79-2.42,2.55-2.42.43,0,.67.07.96.18v-.6s-2.89.01-2.89.01c-.23,0-1.26.04-1.46.04-.77,0-1.24-.18-1.24-.95,0-.9.72-.9,1.19-.9.23,0,1.27.01,1.48.01h2.88s-.01-.66-.01-.66c0-.25-.01-1.02,1.04-1.02s1.04.75,1.04,1.01v.65c.6,0,.61,0,1.21-.01-.13-.06-.17-.11-.44-.58-.14-.23-.3-.43-.48-.68-.08-.11-.13-.23-.13-.31,0-.28.25-.52.56-.52.22,0,.35.11.82.79.37.55.4.71.4.83,0,.16-.07.36-.31.47.52,0,1.21,0,1.21.91s-.73.91-1.12.91c-.26,0-1.44-.01-1.69-.01l.04,3.24Zm-2.88-1.3c-.42,0-.77.35-.77.88s.38.85.78.85.72-.28.72-.88-.41-.85-.73-.85Zm6.74-3.93c0,.31-.26.52-.54.52s-.36-.16-.53-.48c-.29-.54-.5-.83-.73-1.13-.07-.08-.16-.23-.16-.35,0-.36.4-.59.66-.5.35.1,1.29,1.63,1.29,1.94Zm2.68,2.73c-.28.04-.88.12-1.12.12-.68,0-.91-.6-.91-1.08,0-.4.16-.9.84-.96.19-.02,1.03-.07,1.21-.1v-.8c0-.47.01-1.24,1-1.24s1.01.72,1.01,1.08c0,.29-.02,1.55-.04,1.8.64-.59,1.54-1.43,2.9-1.43.17,0,2.46,0,2.46,2.38,0,.6-.4,3.21-.4,3.74,0,.13.01.37.24.37.16,0,.28-.08.6-.28.11-.06.23-.12.37-.12.42,0,.73.46.73.98,0,1.16-1.61,1.57-2.27,1.57-1.5,0-1.85-1.12-1.85-1.97,0-.65.43-3.74.43-4.03,0-.19,0-.67-.59-.67-.5,0-1.21.28-2.66,1.93,0,.67.01,3.65,0,4.25,0,.53-.01,1.19-1.02,1.19-.67,0-1-.38-1-1.02v-1.7c-.56.85-.73,1.09-1.18,1.09-.56,0-1.03-.5-1.03-1.03,0-.28.11-.48.44-.92.28-.38,1.56-2.01,1.81-2.35v-.8Z" stroke="#fff" stroke-width=".5"/>

  <g class="course" fill="none" stroke="red" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
    <polyline id="_5" points="320 60 320 140 260 140 260 190 200 190 200 220 140 220 140 250 80 250 80 320 140 320 140 380 80 380 80 460 140 460 140 510 200 510 200 540"/>
    <polyline id="_4" points="260 60 260 140 320 140 320 240 260 240 260 260 200 260 200 300 140 300 140 320 80 320 80 380 140 380 140 420 200 420 200 480 260 480 260 540"/>
    <polyline id="_3" points="199.91 60 200 100 140 100 140 140 80 140 80 250 140 250 140 300 200 300 200 340 260 340 260 370 320 370 320 430 260 430 260 480 200 480 200 510 140 510 140 540"/>
    <polyline id="_2" points="140 60 140 100 200 100 200 170 140 170 140 220 199.91 220 200 260 260 260 260 300 320 300 320 370 260 370 260 430 320 430 320 540"/>
    <polyline id="_1" points="80 60 80 140 140 140 140 170 200 170 200 190 260 190 260 240 320 240 320 300 260 300 260 340 200 340 200 420 140 420 140 460 80 460 80 540"/>
  </g>
</svg>
<br>
<button id="reset-button">
  やりおなす
</button>



<script type="module">
const svgEl = document.querySelector( 'svg' );
const lineElAll = svgEl.querySelectorAll( '.course polyline' );

lineElAll.forEach( ( lineEl ) => {

  const pathLength = lineEl.getTotalLength();
  lineEl.style.transition = 'none';
  lineEl.style.strokeDasharray = pathLength;
  lineEl.style.strokeDashoffset = pathLength;
  requestAnimationFrame( () => lineEl.style.transition = '' );

  const state = {
    pathLength,
    points: toPoints( lineEl, pathLength / 2 ),
    currentPoint: 0,
    get completed() {

      return this.currentPoint >= this.points.length;

    },
  };

  const dragInfo = {
    activePointerId: null,
  }

  function dragStart( event ) {

    if ( !! dragInfo.activePointerId ) return;

    const svgRect = svgEl.getBoundingClientRect();
    const x = event.clientX - svgRect.left;
    const y = event.clientY - svgRect.top;

    // 最初の10個以内の点との距離が近ければ、スタート
    const closest = {
      index: - 1,
      distance: Infinity,
    };
    const maxDistance = 32;
    const maxDistanceSq = maxDistance ** 2;
    const points = state.points;

    for ( let i = 0; i < 10; i ++ ) {

      const point = getUnProjectedPoint( svgEl, points[ i ].x, points[ i ].y );
      const distanceSq = ( point.x - x ) ** 2 + ( point.y - y ) ** 2;
      if ( distanceSq <= maxDistanceSq && distanceSq < closest.distance ** 2 ) {

        closest.index = i;
        closest.distance = Math.sqrt( distanceSq );

      }

    }

    if ( closest.index !== - 1 ) {

      console.log( 'start' );
      dragInfo.activePointerId = event.pointerId;
      svgEl.classList.add( '-dragging' );
      document.addEventListener( 'pointermove', dragging );

    }

  }

  const DISTANCE_THRESHOLD = 32;
  function dragging( event ) {

    if ( event.pointerId !== dragInfo.activePointerId ) return;

    const svgRect = svgEl.getBoundingClientRect();
    const x = event.clientX - svgRect.left;
    const y = event.clientY - svgRect.top;

    // 現在の周辺の point 10個から、現在位置を判定
    const rangeStart = Math.max( state.currentPoint - 32, 0 );
    const rangeEnd = Math.min( state.currentPoint + 32, state.points.length - 1 );
    const points = state.points.slice( rangeStart, rangeEnd );

    const closest = {
      index: - 1,
      distance: Infinity,
    };
    const maxDistanceSq = DISTANCE_THRESHOLD ** 2;

    for ( let i = 0; i < points.length; i ++ ) {

      const point = getUnProjectedPoint( svgEl, points[ i ].x, points[ i ].y );
      const distanceSq = ( point.x - x ) ** 2 + ( point.y - y ) ** 2;
      if ( distanceSq <= maxDistanceSq && distanceSq < closest.distance ** 2 ) {

        closest.index = i + rangeStart;
        closest.distance = Math.sqrt( distanceSq );

      }

    }

    if ( state.points.length - 3 <= closest.index ) {

      // 最終ポイントから 3 個以内前までに到達したら、ゴールとする
      console.log( 'end' );
      state.currentPoint = state.points.length;
      lineEl.style.strokeDashoffset = 0;

      dragEnd();
      return;

    } else if ( closest.index === - 1 ) {

      console.log( 'canceled' );
      reset();
      dragEnd();

    } else {

      state.currentPoint = closest.index;
      dragInfo.currentPoint = closest.index;
      lineEl.style.strokeDashoffset = state.pathLength - getDistanceFromPathStart( state.pathLength, state.points, dragInfo.currentPoint );

    }

  }

  function dragEnd() {

    document.removeEventListener( 'pointermove', dragging );
    dragInfo.activePointerId = null;

    if ( state.currentPoint !== state.points.length ) {

      reset();

    }

  }

  function reset() {

    state.currentPoint = 0;
    svgEl.classList.remove( '-dragging' );
    lineEl.style.strokeDashoffset = state.pathLength;

  }

  svgEl.addEventListener( 'pointerdown', dragStart );
  document.addEventListener( 'pointerup', dragEnd );
  document.addEventListener( 'pointercancel', dragEnd );
  document.getElementById( 'reset-button' ).addEventListener( 'click', reset );

} );


// -----------------------------------------------------------------------------

function toPoints( pathEl, numOfPoints ) {

	const pathLength = pathEl.getTotalLength();
	const points = [];
	for ( let i = 0; i < numOfPoints; i ++ ) {

		points.push( pathEl.getPointAtLength( pathLength / numOfPoints * i ) );

	}

	return points;

}

function getUnProjectedPoint( svgEl, pointX, pointY ) {

	const svgPoint = svgEl.createSVGPoint();
	svgPoint.x = pointX;
	svgPoint.y = pointY;
	const unProjectedPoint = svgPoint.matrixTransform( svgEl.getCTM() );
	return unProjectedPoint;

}

function getDistanceFromPathStart( pathLength, points, pointIndex ) {

	return ( pathLength / points.length ) * pointIndex;

}
</script>
